#!/bin/sh

SVNAME="$(realpath $0 | cut -d/ -f4)"
SVUSER=${SVNAME##*.}

who -u | grep -q "^$SVUSER" || exit 1

cgm create all "$SVUSER"
cgm removeonempty all "$SVUSER"
cgm setvalue pids "$SVUSER" pids.max 50

exec 2>&1
exec cgexec -g "*:${SVUSER}" --sticky chpst -u "$SVUSER" -P runsvdir -P /home/"$SVUSER"/.local/service
